# IP Login Restrictor v1.3.0 - 変更履歴

## 新機能: ページ単位の臨時IP制御および救済URLの強化

### 概要
各投稿や固定ページごとに、そのページ専用の臨時IPアドレスを設定できるようになりました。また、アクセス拒否画面にページ独自のメッセージを表示する機能や、レスキューURLのカスタマイズ機能を追加しました。

### 主な変更点

#### 1. ページ単位の臨時IP制御
- 投稿・固定ページの編集画面のサイドバーに「IP Login Restrictor - 臨時IP設定」メタボックスを追加
- **機能スイッチ**: ページごとに臨時IP制限を「有効/無効」に切り替え可能
- **独立した制御**: プラグイン全体のフロントエンド制限が「無効」でも、ページ個別に有効化すればそのページだけをIP制限可能
- 1行に1つのIPアドレスを入力可能（CIDR表記にも対応）
- 「現在のIPを追加」ボタンで、簡単にIPを追加可能

#### 2. アクセス拒否画面のカスタマイズ（ページ別）
- **一言メッセージ設定**: ページごとにアクセス拒否時に表示したいメッセージを設定可能
- **新トークン `{page_message}`**: 拒否画面のHTML設定で `{page_message}` トークンが使用可能
- **自動表示ガード**: HTML設定にトークンが含まれていなくても、メッセージが設定されていれば最後に自動付加して表示（デフォルトのテンプレートはスッキリした状態のまま、メッセージがある時だけ現れます）

#### 3. レスキューURLのカスタマイズ強化
- **パラメータ名の変更**: URLの `?iplr_rescue=` の部分（パラメータキー）を自由に変更可能に
- **セキュリティ向上**: 独自のパラメータ名とキー値を組み合わせることで、救済URLの推測をより困難に

#### 4. 投稿一覧画面の拡張
- 投稿一覧・固定ページ一覧に「臨時IP」カラムを追加
- 設定の有効/無効状態をアイコン（✓/✗）で表示
- 設定されているIPの数と内容（最大3件まで）を表示

#### 5. 翻訳の拡充
- 新機能に関する日本語翻訳（有効、無効、パラメータキーなど）を完全追加

### 技術的な詳細

#### 新しい定数
```php
const META_TEMPORARY_IPS = '_iplr_temporary_ips'; // ページ固有の臨時IP
const META_TEMPORARY_IPS_MESSAGE = '_iplr_temporary_ips_message'; // ページ固有のメッセージ
const OPTION_RESCUE_PARAM = 'ip_login_restrictor_rescue_param'; // URLパラメータキー設定
```

#### ロジックの改善
- `get_queried_object_id()` を使用し、フロントエンドでのID取得の確実性を向上
- 文字列置換処理において、トークンの有無にかかわらず情報を保護するフォールバック処理を実装

### バージョン情報
- **バージョン**: 1.2.1 → 1.3.0
- **リリース日**: 2025-12-20

### 互換性
- 既存の設定や救済URL（デフォルト `iplr_rescue`）はそのまま維持されます。
- プラグイン全体の動作に影響を与えず、必要なページにのみ制限をかけることが可能です。
