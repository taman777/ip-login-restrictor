# IP Login Restrictor

WordPress のログイン画面・管理画面、さらに必要に応じてフロントエンド（公開ページ）へのアクセスを、特定の IP アドレスまたは CIDR で簡単に制限できるセキュリティプラグインです。

## こんなシチュエーションに最適 ✨

*   **開発中・リニューアル中のサイトのテスト公開に**  
    「関係者だけにサイトを見せたい」「クライアントのオフィスからのみアクセスさせたい」といった場合に、パスワード制限よりも手軽かつ確実にアクセスを制御できます。
*   **管理画面のセキュリティ強化に**  
    不特定多数からの不正ログイン試行をシャットアウト。自分やスタッフの固定IPのみを許可することで、鉄壁のセキュリティを実現します。
*   **社内ポータルや会員制サイトの基盤として**  
    特定の社内ネットワーク（VPN等）からのアクセスのみを許可するイントラネット的な運用にも利用可能です。

---

## 主な機能 🚀

### 1. 2つの独立したIPホワイトリスト
用途に合わせて、2種類の制限を個別に設定できます。

*   **管理者・ログイン用リスト**:  
    管理画面 (`/wp-admin/`) および ログイン画面 (`wp-login.php`) へのアクセスを許可するIPリスト。ここに追加されたIPは、フロントエンドへのアクセスも自動的に許可されます。
*   **フロントエンド専用リスト**:  
    通常の公開ページ（フロントエンド）のみ閲覧を許可するIPリスト。外部の制作パートナーやクライアントに「表示確認だけさせたい（管理画面には入らせたくない）」場合に便利です。

### 2. レスキューURL（緊急避難機能）🚑
「IPアドレスが変わってしまって管理画面に入れない！」
そんな時のために、独自の **「レスキューURL（Rescue URL）」** を生成できます。
あらかじめ設定しておいた秘密のキーを含むURLにアクセスするだけで、**その時の新しいIPアドレスを自動的にホワイトリストに追加** し、ロックアウト状態から復帰できます。

### 3. wp-config.php によるオーバーライド
FTPアクセスが可能であれば、設定ファイル (`wp-config.php`) を編集することで強制的にアクセスを許可できます。

*   `WP_LOGIN_IP_ADDRESS`: 緊急許可IPを指定（カンマ区切りで複数可）
*   `REMOVE_WP_LOGIN_IP_ADDRESS`: `true` を設定すると、全てのIP制限を無効化

### 4. その他のこだわり機能
*   **HTMLメッセージカスタマイズ**: アクセス拒否画面のメッセージを自由に編集可能。テーマのデザイン（ヘッダー・フッター）をそのまま引き継ぐため、サイトのブランドイメージを損ないません。
*   **ワンクリック追加**: 管理画面にアクセス中の自分のIPアドレスを、ボタン一つでリストに追加できます。
*   **CIDR対応**: 個別のIPだけでなく、`192.168.1.0/24` のような範囲指定もサポート。
*   **管理バー連携**: 現在の機能有効状態や、自分のIPアドレスをWordPress上部の管理バーですぐに確認できます。

---

## 使用方法 🛠️

### 1. 基本設定
プラグインを有効化したら、管理画面の「IP Login Restrictor」設定ページへ移動します。
初期状態では機能は **「無効」** になっています。

### 2. IPアドレスの登録
*   **Admin & Login Allowed IPs**: 自分や管理者のIPを入力します。
*   **Frontend Only Allowed IPs**: 確認用ユーザーなどのIPを入力します。

「現在のIPを追加」ボタンを押すと、今アクセスしているIPが自動入力されます。

### 3. 制限の開始
「ステータス」を **「有効」** に切り替えて保存すると、管理画面・ログイン画面への制限が即座に適用されます。
公開ページ（フロントエンド）も制限したい場合は、「フロントエンドの制限」も **「制限する」** に設定してください。

### 4. レスキューキーの設定（推奨）
万が一のために、「レスキューキー」に任意の英数字（パスワードのようなもの）を設定しておきましょう。
生成された **レスキューURL** をスマートフォンやブラウザのブックマークに保存しておけば、外出先でIPが変わっても安心です。

---

## 注意事項 ⚠️

*   **自分のIPを追加し忘れないように注意してください。** 有効化した瞬間から制限が始まります。
*   もし締め出されてしまった場合は、上述のレスキューURLを使うか、FTP等で `wp-config.php` を編集して復旧してください。

---

## License
GPLv2 or later
